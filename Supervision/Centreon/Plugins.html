<!--
title: Les plugins
description: Les commandes à l'aide de plugins
published: true
date: 2021-05-23T16:27:15.493Z
tags: 
editor: ckeditor
dateCreated: 2021-05-23T16:18:38.911Z
-->

<figure class="image image_resized" style="width:44.15%;"><img src="https://static.centreon.com/wp-content/uploads/2019/10/Centreon_Logo_RVB_HD_Cut.png?x55598" alt="Centreon | Supervision Informatique : Infrastuctures Hybrides, Cloud, AIOps"></figure>
<h1>Mise en place de commandes (checks) à l’aide de plugins</h1>
<p>En plus des différents checks disponibles par défaut dans Centreon, il existe des plugins, gratuit ou payant, que l’on peut télécharger.<br>Centreon étant un outil de supervision open source et communautaire, il est également possible de trouver des plugins gratuits mis à disposition par la communauté.<br>Une autre solution est de créer directement ses propres plugins, à condition d’avoir les connaissances nécessaires.</p>
<h2>Configuration des checks a partir des Packs de Plugins inclus dans Centreon</h2>
<h3>Ajout de Plugins</h3>
<p>Centreon est un excellent outil de supervision qui peut être configuré manuellement pour correspondre exactement aux différents besoins de l’entreprise. Toutefois, il existe des packs de plugins contenant des modèles de configuration.<br>Ces différents packs réduisent le temps nécessaire pour installer et superviser la plupart des services de l’entreprise.<br>Pour fonctionner, les composants techniques Centreon License Manager et Centreon Plugin Pack Manager sont nécessaires.*</p>
<p>L’installation de ces deux paquets est très simple.<br>En fonction de la version de Centreon utilisée, il sera nécessaire soit d’installer en ligne de commande ces deux packages soit directement de les installer depuis l’interface graphique.</p>
<p>Pour commencer se rendre dans la section «&nbsp;Administration&nbsp;» puis «&nbsp;Extensions&nbsp;» et enfin «&nbsp;Modules&nbsp;».<br>Vérifier si les deux modules sont présents.&nbsp;</p>
<figure class="image"><img src="/images/plugins_centreon-5.png"></figure>
<p>S’ils n’y sont pas, il faudra installer les packages en ligne de commande avant de poursuivre.<br>Pour effectuer l’installation des packages en ligne de commande, se connecter sur le serveur Centreon avec l’utilisateur root en SSH et de taper la commande suivante.</p>
<pre><code class="language-plaintext">yum install centreon-pp-manager</code></pre>
<p>Cette commande téléchargera Centreon Plugin Pack Manager et également Centreon License Manager en tant que dépendance.<br>Une fois ces deux paquets téléchargés et présent dans «&nbsp;Modules&nbsp;», il suffira de les installer.<br>Le premier module à installer et activer sera Centreon License Manager&nbsp;: cliquer sur le nom du module puis sur «&nbsp;install moduel&nbsp;»</p>
<figure class="image"><img src="/images/plugins_centreon-6.png"></figure>
<p>Puis il faudra installer et activer Centreon Plugin Pack Manager&nbsp;: cliquer sur le nom du module puis sur «&nbsp;install moduel&nbsp;»</p>
<figure class="image"><img src="/images/plugins_centreon-7.png"></figure>
<p>Lorsque les deux modules seront installés, il sera désormais possible de se rendre dans la section «&nbsp;Configuration&nbsp;» puis «&nbsp;Plugin packs&nbsp;» pour trouver les 6 plugins gratuits proposés. Si on s’inscrit sur le site de Centreon, 5 autres plugins packs deviennent gratuits, les autres étant payant.</p>
<p>Il existe plus de 150 plugins packs disponibles dans l’offre IMP.</p>
<figure class="image"><img src="/images/plugins_centreon-8.png"></figure>
<h3>Activation des modules selon les besoins</h3>
<p>Comme indiqué précédemment, suite à l’installation des deux modules, des packs de plugins sont maintenant disponible.<br>Pour activer les plugins, se rendre dans «&nbsp;Configuration&nbsp;» puis «&nbsp;Plugin packs&nbsp;», puis cliquer sur le plugin à installer.<br>Dans le cadre de cette procédure, le plugin de check SNMP de Linux sera installé&nbsp;</p>
<figure class="image"><img src="/images/plugins_centreon-9.png"></figure>
<p>Cliquer sur le plugin pour afficher les détails&nbsp;</p>
<figure class="image"><img src="/images/plugins_centreon-10.png"></figure>
<p>Pour l’installer il suffit de cliquer sur l’icone <span class="text-huge"><strong>+</strong></span><br>Patienter pour que le plugin s’installe automatiquement.<br>Une fois installé l’icône du plugin affiche une marque, confirmant l’installation&nbsp;</p>
<figure class="image"><img src="/images/plugins_centreon-11.png"></figure>
<p>Les différents checks et Templates seront à présent disponibles dans leurs sections respectives.</p>
<h3>Utilisation des checks fournis par les modules</h3>
<p>Pour utiliser les différents checks inclus dans les packs de modules il faut absolument garder en tête la notion d’héritage qui a été précédemment expliqué.<br>En effet, les commandes, Templates de services et Templates d’Hôtes sont déjà liés les uns aux autres lors de l’installation d’un pack.</p>
<p><u>Petit rappel&nbsp;:&nbsp;</u></p>
<figure class="image"><img src="/images/checks_centreon.png"></figure>
<p>Généralement, lors de l’installation d’un pack, cette notion de hiérarchie et d’héritage ne sera pas retouchée mais plutôt utilisée.<br>Il sera toutefois nécessaire de customiser les valeurs des «&nbsp;warning&nbsp;», «&nbsp;critical&nbsp;» et autres valeurs à vérifier.<br>Pour les besoins de cette procédure voici un exemple.<br>Lors de l’’installation des packs «&nbsp;Linux SNMP&nbsp;» ou «&nbsp;Windows SNMP&nbsp;», le Template de service «&nbsp;Base-Ping-LAN&nbsp;» devient accessible.</p>
<figure class="image"><img src="/images/plugins_centreon-12.png"></figure>
<p>Ce Template va permettre d’effectuer la supervision de la connectivité réseau à l’aide du ping pour les hôtes liés à ce Template. Toutefois il est nécessaire de le configurer selon ses besoins, le nombre de paquets envoyés ou les valeurs pour le «&nbsp;warning&nbsp;» et «&nbsp;critical&nbsp;» ne sont pas forcément celles que l’on souhaite. Il est également important de positionner correctement l’ensemble des périodes de check, des intervalles de supervision ainsi que les notifications comme indiqué précédemment dans cette procédure.</p>
<p>En effet par défaut, tout est vide.</p>
<figure class="image"><img src="/images/plugins_centreon-13.png"></figure>
<h3>Personnalisation des Checks à partir de ceux des plugins</h3>
<p>Une fois les plugins installés, un certain nombre de commandes et de Templates sont disponibles.<br>Nous avons vu comment les utiliser mais il est également possible si on le souhaite de ne pas utiliser les Templates prédéfinies et de recréer ses propres Templates à partir des commandes (checks) disponibles.<br>Pour cela il faudra procéder de la même façon que précédemment dans cette procédure.</p>
<h2>Configuration des checks à partir des packs de plugins fournis par la communauté</h2>
<p>Il existe de nombreux sites proposant des listes de plugins mis à disposition gratuitement.<br>Par exemple, le site «&nbsp;exchange Nagios&nbsp;» est plutôt bien fourni&nbsp;: <a href="https://exchange.nagios.org">https://exchange.nagios.org</a><br>Toute fois pour les besoins de cette procédure, nous allons prendre en exemple le plugin «&nbsp;centreon_plugins.pl&nbsp;».<br>Il s’agit d’un plugin écrit en perl qui est très complet et qui permet de mettre en place un très grand nombre de checks différents.</p>
<h3>Installation de «&nbsp;centreon_plugins.pl&nbsp;»</h3>
<p>Avant toute chose, si ce n’est pas déjà fait il faut installer la commande «&nbsp;git&nbsp;»&nbsp;</p>
<pre><code class="language-plaintext">yum install git</code></pre>
<p>Une fois la commande installée, se déplacer dans le répertoire /tmp puis télécharger le plugin depuis <a href="https://github.com/centreon/centreon-plugins">Github</a>&nbsp;à l’aide des commandes ci-dessous :</p>
<pre><code class="language-plaintext">cd /tmp
git clone https://github.com/centreon/centreon-plugins</code></pre>
<p>Le répertoire «&nbsp;centreon-plugins&nbsp;» devrait être visible dans /tmp</p>
<pre><code class="language-plaintext">ll
drwxr-xr-x 17 root root 309 27 août&nbsp; 16:24 centreon-plugins</code></pre>
<p>Déplacer le dossier dans /usr/lib/nagios/plugins/ puis lui ajouter les droits nécessaires pour son exécution par centreon&nbsp;</p>
<pre><code class="language-plaintext">cp centreon-plugins /usr/lib/nagios/plugins/
cd /usr/lib/nagios/plugins
chmod 755 -Rf centreon-plugins
chown -Rf centreon:centreon centreon-plugins</code></pre>
<h3>Utilisation du plugin «&nbsp;centreon_plugins.pl&nbsp;»</h3>
<p>Avant de commencer, voici le contenu du dossier&nbsp;:</p>
<pre><code class="language-plaintext">drwxr-xr-x 47 centreon centreon&nbsp; 4096 16 juil. 12:47 apps
drwxrwxr-x&nbsp; 4 centreon centreon&nbsp;   35 16 juil. 12:47 centreon
-rwxr-xr-x&nbsp; 1 centreon centreon&nbsp;  989 16 juil. 12:34 centreon_plugins.pl
-rwxr-xr-x&nbsp; 1 centreon centreon 15135 16 juil. 12:34 changelog
drwxr-xr-x&nbsp; 7 centreon centreon&nbsp;   77 16 juil. 12:47 cloud
drwxr-xr-x&nbsp; 2 centreon centreon&nbsp;   46 16 juil. 12:47 contrib
drwxr-xr-x 10 centreon centreon&nbsp;  119 16 juil. 12:47 database
drwxr-xr-x&nbsp; 4 centreon centreon&nbsp;   26 16 juil. 12:47 docs
drwxr-xr-x&nbsp; 4 centreon centreon&nbsp;  107 16 juil. 12:47 example
drwxr-xr-x 10 centreon centreon&nbsp;  110 16 juil. 12:47 hardware
-rwxrwxr-x&nbsp; 1 centreon centreon&nbsp; 2752 20 août&nbsp; 10:24 host-email.php
-rwxr-xr-x&nbsp; 1 centreon centreon 11357 16 juil. 12:34 LICENSE.txt
drwxr-xr-x 63 centreon centreon&nbsp; 4096 16 juil. 12:47 network
drwxr-xr-x&nbsp; 5 centreon centreon&nbsp;   48 16 juil. 12:47 notification
drwxr-xr-x&nbsp; 8 centreon centreon&nbsp;   87 16 juil. 12:47 os
-rwxr-xr-x&nbsp; 1 centreon centreon&nbsp; 3194 16 juil. 12:34 README.md
-rwxrwxr-x&nbsp; 1 centreon centreon&nbsp; 5180 20 août&nbsp; 10:24 service-email.php
drwxr-xr-x&nbsp; 3 centreon centreon&nbsp;   18 16 juil. 12:47 snmp_standard
drwxr-xr-x 23 centreon centreon&nbsp;  305 16 juil. 12:47 storage</code></pre>
<p><u>A savoir&nbsp;:</u></p>
<ul>
  <li>Les parties en bleues sont des dossiers contenant les informations que le plugin va utiliser lors des différents checks.</li>
  <li>Les parties en vert sont des exécutables. Celui qui nous intéresse et que nous utiliserons est «&nbsp;centreon_plugins.pl&nbsp;».</li>
</ul>
<p>Précédemment nous avons vu que lorsque nous utilisions une commande, la variable «&nbsp;<i>$USER1$</i>&nbsp;» était utilisée.<br>Elle correspond au chemin suivant&nbsp;: <i>/usr/lib/nagios/plugins/</i> et permet de faire appel aux commandes se trouvant dans ce répertoire.<br>Par exemple&nbsp;: <i>/usr/lib/nagios/plugins/check_centreon_snmp_memory</i> en y associant les valeurs nécessaires au check permettra d’effectuer un check de la RAM sur le ou les appareils ciblés.</p>
<pre><code class="language-plaintext">$USER1$/check_centreon_snmp_memory -H $HOSTADDRESS$ -C $ARG1$ -v $ARG2$ -w $ARG3$ -c $ARG4$</code></pre>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
