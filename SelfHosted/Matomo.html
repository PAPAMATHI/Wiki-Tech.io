<!--
title: Matomo
description: Enfin une alternative viable à Google Analytics !
published: true
date: 2021-05-03T13:58:50.967Z
tags: 
editor: ckeditor
dateCreated: 2021-05-03T11:22:10.212Z
-->

<figure class="image image_resized" style="width:64.09%;"><img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/c9/Matomo_Logo.svg/1280px-Matomo_Logo.svg.png" alt="Fichier:Matomo Logo.svg — Wikipédia"></figure>
<h1>Présentation</h1>
<h1>Installation</h1>
<p>Vous pouvez passer par une installation standard via la documentation disponible sur <a href="https://fr.matomo.org/docs/installation/">leur site</a>, le déployer directement depuis mon template d'application dans Portainer (tutoriel dispo ici) ou utiliser le docker-compose suivant :</p>
<pre><code class="language-plaintext">version: "2"
services:
  # Base de données    
  matomo-db:
    image: linuxserver/mariadb
    container_name: matomo-db
    restart: unless-stopped
    environment:
      - PUID=1000
      - PGID=1000
      - MYSQL_ROOT_PASSWORD=pihvzlbkcgvlknfze!ef6e4
      - TZ=Europe/Paris
      - MYSQL_DATABASE=matomo
      - MYSQL_USER=matomo
      - MYSQL_PASSWORD=Matomo65468431
      # Flag necessary for the database max allowed packet check
      # https://matomo.org/faq/troubleshooting/faq_183/
      - MARIADB_EXTRA_FLAGS=--max_allowed_packet=64MB
    volumes:
      - /apps/matomo/db:/config

    # Facultatif
    networks:
      - proxy
    logging:
      driver: loki
      options:
        loki-url: "$URL_LOKI"
        loki-external-labels: service={{.Name}}
        
  # Matomo : https://fr.matomo.org
  matomo:
    image: matomo
    container_name: matomo
    restart: unless-stopped
    environment:
      - MATOMO_DATABASE_HOST=matomo-db
      - MATOMO_DATABASE_DBNAME=matomo
      - MATOMO_DATABASE_USERNAME=matomo
      - MATOMO_DATABASE_PASSWORD=Matomo65468431
    volumes:
      - /apps/matomo/data:/var/www/html matomo
    depends_on:
      - matomo-db
    # Facultatif avec Traefik  
    #Ports:
    #  - 80:80

    # Facultatif  
    networks:
      - proxy
    logging:
      driver: loki
      options:
        loki-url: "$URL_LOKI"
        loki-external-labels: service={{.Name}}
    labels:
      - "traefik.enable=true"
      - "traefik.http.routers.matomo.entrypoints=http"
      - "traefik.http.routers.matomo.rule=Host(`$URL`)"
      - "traefik.http.middlewares.matomo-https-redirect.redirectscheme.scheme=https"
      - "traefik.http.routers.matomo.middlewares=matomo-https-redirect"
      - "traefik.http.routers.matomo-secure.entrypoints=https"
      - "traefik.http.routers.matomo-secure.rule=Host(`$URL`)"
      - "traefik.http.routers.matomo-secure.tls=true"
      - "traefik.http.routers.matomo-secure.tls.certresolver=http"
      - "traefik.docker.network=proxy"

      
networks:
  proxy:
    external:
      name: proxy</code></pre>
<blockquote>
  <p><strong>Attention :</strong> Pensez à changer dans le docker-compose ou à définir les variables suivantes : <i><strong>$URL_LOK</strong></i><strong>I </strong>et <strong>$URL</strong> en fonction de votre installation.</p>
</blockquote>
<p>Votre Matomo sera accessible directement depuis l'URL que vous lui aurais attribué avec Traefik ou depuis <code>http://&lt;server&gt;:&lt;port&gt;</code>.<br>&nbsp;</p>
<h1>Configuration</h1>
<h2>Site Wordpress</h2>
<p>Le plus simple reste de passer par une extension :</p>
<p>&nbsp;1 - Ajoutez un site dans Matomo</p>
<p>&nbsp;2 - Connectez vous en administrateur sur votre Wordpress</p>
<p>&nbsp;3 - Ajoutez et activez l'extension “<a href="https://wordpress.org/plugins/piwik-tracking-by-mente-binaria/"><code><strong>Tracking code for Matomo, by Sergio Santos</strong></code></a><strong>”&nbsp;</strong></p>
<p>&nbsp;4 - Allez dans les réglages de l'extension</p>
<p>&nbsp;5 - Activez le code de tracking</p>
<p>&nbsp;6 - Rentrez l'adresse de votre serveur Matomo</p>
<p>&nbsp;7 - Activez la compatibilité SSL si vous l'utilisez</p>
<p>&nbsp;8 - Enregistrez les modifications &amp; Enjoy !&nbsp;</p>
<p>&nbsp;</p>
<h2>Wiki.js</h2>
<p>Dans Wiki.js c'est directement intégré ! Si c'est pas beau la vie !</p>
<p>&nbsp;1 - Rendez vous dans la partie administrateur de Wiki.js</p>
<p>&nbsp;2 - Dans la catégorie “<i>Analytiques</i>”, sélectionnez “<i>Matomo</i>”</p>
<p>&nbsp;3 - Entrez l'ID de votre site (dispo sur votre serveur Matomo) ainsi que l'URL de votre serveur Matomo</p>
<p>&nbsp;4 - Cliquez sur “<i>Appliquer</i>” &amp; Enjoy !&nbsp;</p>
<p>&nbsp;</p>
<h2>Site web classique</h2>
<p>Après avoir configurer le site dans Matomo, il vous fournis un code que vous pouvez rajouter à votre site directement entre le head et le body. Voici un exemple du code fournit :</p>
<pre><code class="language-html">&lt;!-- Matomo --&gt;
&lt;script type="text/javascript"&gt;
  var _paq = window._paq = window._paq || [];
  /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//&lt;SERVEUR_MATOMO/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '6']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
&lt;/script&gt;
&lt;!-- End Matomo Code --&gt;</code></pre>
<p>&nbsp;</p>
